{"version":3,"sources":["../../src/pages/chat/messages/messages.module.ts","../../src/pipes/pipes.module.ts","../../src/pipes/safe.pipe.ts","../../src/pipes/moment.pipe.ts","../../src/pages/chat/messages/messages.ts"],"names":[],"mappings":"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","file":"5.js","sourcesContent":["import { PipesModule } from '../../../pipes/pipes.module';\r\nimport { NgModule } from '@angular/core';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { MessagesPage } from './messages';\r\n\r\n@NgModule({\r\n    declarations: [MessagesPage],\r\n    imports: [IonicPageModule.forChild(MessagesPage), TranslateModule, PipesModule],\r\n    exports: [MessagesPage]\r\n})\r\nexport class MessagesPageModule { }\n\n\n// WEBPACK FOOTER //\n// ./src/pages/chat/messages/messages.module.ts","import { SafePipe } from './safe.pipe';\r\nimport { MomentPipe } from './moment.pipe';\r\nimport { NgModule } from '@angular/core';\r\n\r\n@NgModule({\r\n    declarations: [MomentPipe, SafePipe],\r\n    imports: [],\r\n    exports: [MomentPipe, SafePipe]\r\n})\r\nexport class PipesModule { }\n\n\n// WEBPACK FOOTER //\n// ./src/pipes/pipes.module.ts","import { Pipe } from '@angular/core';\r\nimport { DomSanitizer, SafeHtml, SafeStyle, SafeScript, SafeUrl, SafeResourceUrl } from '@angular/platform-browser';\r\n\r\n@Pipe({\r\n\tname: 'safe'\r\n})\r\nexport class SafePipe {\r\n\r\n\tconstructor(protected _sanitizer: DomSanitizer) {\r\n\r\n\t}\r\n\r\n\tpublic transform(value: string, type: string = 'html'): SafeHtml | SafeStyle | SafeScript | SafeUrl | SafeResourceUrl {\r\n\t\tswitch (type) {\r\n\t\t\tcase 'html': return this._sanitizer.bypassSecurityTrustHtml(value);\r\n\t\t\tcase 'style': return this._sanitizer.bypassSecurityTrustStyle(value);\r\n\t\t\tcase 'script': return this._sanitizer.bypassSecurityTrustScript(value);\r\n\t\t\tcase 'url': return this._sanitizer.bypassSecurityTrustUrl(value);\r\n\t\t\tcase 'resourceUrl': return this._sanitizer.bypassSecurityTrustResourceUrl(value);\r\n\t\t\t//default: throw new Error(`Invalid safe type specified: ${type}`);\r\n\t\t\tdefault: return this._sanitizer.bypassSecurityTrustUrl(value);\r\n\t\t}\r\n\t}\r\n\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/pipes/safe.pipe.ts","import { Pipe } from '@angular/core';\r\nimport * as moment from 'moment';\r\nimport 'moment/locale/pt';\r\n\r\n// under systemjs, moment is actually exported as the default export, so we account for that\r\n//-const momentConstructor: (value?: any) => moment.Moment = (<any>moment).default || moment;\r\n\r\n@Pipe({\r\n    name: 'moment'\r\n})\r\nexport class MomentPipe {\r\n\r\n    transform(value, args) {\r\n        args = args || '';\r\n        return args === 'ago' ? moment(value).fromNow() : moment(value).format(args);\r\n      }\r\n\r\n    /*transform(value: Date | moment.Moment, args?: any): any {\r\n        let formats: any = null;\r\n        let referenceTime: any = null;\r\n\r\n        if (typeof args === 'object' && !moment.isMoment(args)) {\r\n            formats = args;\r\n         } else {\r\n            referenceTime = momentConstructor(args);\r\n        }\r\n\r\n        return momentConstructor(value).calendar(referenceTime, formats);\r\n    }*/\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/pipes/moment.pipe.ts","import { Component, ViewChild, Output, EventEmitter, OnDestroy } from '@angular/core';\r\nimport { FormControl, FormBuilder } from '@angular/forms';\r\nimport { IonicPage, Content, LoadingController, NavController, NavParams, TextInput } from 'ionic-angular';\r\nimport { AuthProvider } from '../../../providers/auth-provider';\r\nimport { SocketProvider } from '../../../providers/socket-provider';\r\nimport { User, ChatUser, ChatMessage } from '../../../providers/epm-types';\r\nimport { Subscription } from 'rxjs/Subscription';\r\n\r\n@IonicPage()\r\n@Component({\r\n  selector: 'page-messages',\r\n  templateUrl: 'messages.html'\r\n})\r\nexport class MessagesPage {\r\n  subscription: Subscription;\r\n  @ViewChild(Content) content: Content;\r\n  @ViewChild('chat_input') messageInput: TextInput;\r\n  @Output() chatNotification = new EventEmitter();\r\n\r\n  private user: User;\r\n  private userPic: string = 'assets/img/avatar.png';\r\n\r\n  private loading = true;\r\n  public messageForm: any;\r\n\r\n  private chatMessages: any = {};\r\n  private userMessages: Array<ChatMessage> = [];\r\n\r\n  private chatBox: string;\r\n  private chatUser: ChatUser = null;\r\n  private showEmojiPicker = false;\r\n\r\n  constructor(public navCtrl: NavController, public formBuilder: FormBuilder,\r\n    public loadingCtrl: LoadingController, public params: NavParams,\r\n    public messageService: SocketProvider, private auth: AuthProvider) {\r\n\r\n    this.user = this.auth.getUser();\r\n    this.chatUser = this.params.get('chatUser');\r\n    this.loading = true;\r\n    this.messageForm = formBuilder.group({\r\n      message: new FormControl('')\r\n    });\r\n    this.chatBox = \"\";\r\n    this.loadMessages();\r\n  }\r\n\r\n  loadMessages() {\r\n    this.subscription = this.messageService.messages().subscribe(data => {\r\n      this.chatMessages = data;\r\n      this.loadUserMessages();\r\n    });\r\n  }\r\n\r\n  loadUserMessages() {\r\n    if (this.chatMessages && this.chatUser != null) {\r\n      console.log(\"loadUserMessages : chatMessages\", this.chatUser, this.chatMessages);\r\n      // user messages\r\n      let user_: string = this.chatUser.userId + \"\";\r\n      if (this.chatMessages[user_] == undefined || this.chatMessages[user_] == null) {\r\n        this.chatMessages[user_] = [];\r\n      }\r\n      // user photo\r\n      if (!this.chatUser.photo) {\r\n\r\n      }\r\n      this.userMessages = this.chatMessages[user_];\r\n      this.messageService.readMessages(user_);\r\n    } else {\r\n      this.userMessages = [];\r\n    }\r\n    setTimeout(() => {\r\n      console.log(\"userMessages\", this.userMessages);\r\n      this.loading = false;\r\n\r\n      setTimeout(() => {\r\n        this.content.scrollToBottom();\r\n      }, 5);\r\n    }, 500);\r\n  }\r\n\r\n  sendMsg() {\r\n    if (this.chatBox && this.chatBox != \"\" && this.chatUser != null) {\r\n      this.messageService.sendMessage(this.chatUser.userId, this.chatBox);\r\n      //this.scrollToBottom();\r\n    }\r\n    this.chatBox = \"\";\r\n  }\r\n\r\n  onFocus() {\r\n    this.showEmojiPicker = false;\r\n    this.content.resize();\r\n    this.scrollToBottom();\r\n  }\r\n\r\n  scrollToBottom() {\r\n    setTimeout(() => {\r\n      if (this.content.scrollToBottom) {\r\n        this.content.scrollToBottom();\r\n      }\r\n    }, 400)\r\n  }\r\n\r\n  switchEmojiPicker() {\r\n    this.showEmojiPicker = !this.showEmojiPicker;\r\n    if (!this.showEmojiPicker) {\r\n      this.messageInput.setFocus();\r\n    }\r\n    this.content.resize();\r\n    this.scrollToBottom();\r\n  }\r\n\r\n  ionViewWillUnload() {\r\n    // unsubscribe to ensure no memory leaks\r\n    this.subscription.unsubscribe();\r\n  }\r\n\r\n  viewProfile(profile) {\r\n    console.log('oi');\r\n  }\r\n\r\n  goBack() {\r\n    this.navCtrl.pop();\r\n  }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/pages/chat/messages/messages.ts"],"sourceRoot":""}